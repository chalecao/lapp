"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},u=function(t){return function(n){return(void 0===n?"undefined":e(n))===t}},a=function(e){return function(t){return t.type===e}},c=function(e){return u("undefined")(e)&&void 0==e},d=u("string"),f=u("boolean"),l=u("number"),s=function(e){return e.toString().match("function")},p=function(e){return e.toString().match("class ")},h=function(e){return null===e},v=a("native"),y=a("thunk"),b=a("text"),m=Array.isArray,g=function(e){return"Object"==Object.prototype.toString.call(e).slice(8,-1)},O=function(e,t){return e.fn===t.fn},k=function(e){return["svg","path","animate"].indexOf(e)>=0},_=function(e){return/^on/.test(e)},j=function(e){return e.slice(2).toLowerCase()},x=function t(n,r){var o={};return Object.keys(n).forEach(function(i){o[r+"."+i]=n[i],"object"===e(n[i])&&(o=Object.assign(o,t(n[i],r+"."+i)))}),o},E=function(e,t){var n=-1,r=e.find(function(e,r){if(e.fn&&e.fn.toString().match(t))return n=r,!0});return{index:n,children:r}},A=function e(t){var n;if(g(t))n={};else{if(!m(t))return t;n=[]}for(var r in t){var o=t[r];g(o)?n[r]=e(o):m(o)?n[r]=e(o):n[r]=t[r]}return n};function N(e){for(var t=arguments,n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=t[o];var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e)return r=Array.prototype.reduce.call(r,S,[]),s(e)?w(e,i,r,e):{type:"native",tagName:e,attributes:i,children:r}}function w(e,t,n,r){return{type:"thunk",fn:e,props:t,children:n,options:r}}function $(e){return{type:e?"text":"empty",nodeValue:e}}function S(e,t){return d(t)||l(t)?e.push($(t)):h(t)||c(t)||(m(t)?e=[].concat(i(e),i(t.reduce(S,[]))):e.push(t)),e}var C=function(){function e(){t(this,e)}return n(e,[{key:"$update",value:function(e){e&&e()}},{key:"render",value:function(){}}]),e}();function P(e,t){t&&Object.keys(t).forEach(function(n){_(n)&&e.addEventListener(j(n),t[n])})}function V(e,t){t&&Object.keys(t).forEach(function(n){_(n)&&e.removeEventListener(j(n),t[n])})}function M(e,t,n,r){n?(e[r](t,n),e[t]=!0):(e[r](t),e[t]=!1)}function L(e,t,n,r){_(t)||("className"===t?e[r]("class",n):f(n)?M(e,t,n,r):void 0!=n&&(""+n).length?e[r](t,n):e.removeAttribute(t))}function T(e,t,n,r){n?r&&n===r||L(e,t,n,"setAttribute"):L(e,t,f(n)?n:r,"removeAttribute")}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n,t);Object.keys(r).forEach(function(r){_(r)?(V(e,{name:n[r]}),P(e,{name:t[r]})):T(e,r,t[r],n[r])})}function U(e){var t=d(e)||l(e)?e:"";return document.createTextNode(t)}function F(e,t){var n=e.props,r={children:e.children,props:n},o=void 0,i=void 0;if(p(e.fn))o=(i=new e.fn).render(r),i.$update=i.$update.bind(this,function(){t&&t("updateAll")});else try{o=e.fn(r)}catch(n){o=(i=new e.fn).render(r),i.$update=i.$update.bind(this,function(){t&&t("updateAll")})}if(!o)return"";o.attributes.onMount&&o.attributes.onMount();var u=z(o);return P(u,o.attributes),o.attributes.afterMount&&o.attributes.afterMount(),e.state={vnode:o,$ins:i,model:r},u}function q(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function H(e,t){var n=k(e.tagName)?q(e.tagName):document.createElement(e.tagName);return e.attributes&&R(n,e.attributes),e.attributes&&P(n,e.attributes),e.children.map(function(n){return"thunk"==n.type&&(n.fn.$update=function(){return e.fn.$update&&e.fn.$update()}),z(n,t)}).forEach(n.appendChild.bind(n)),n}function I(){return document.createElement("noscript")}var z=function(e,t){if(!h(e)&&!c(e))switch(e.type){case"text":return U(e.nodeValue);case"thunk":return F(e,t);case"empty":return I();case"native":return H(e,t)}};function B(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e)return t===n&&"thunk"!=t.type?e:!c(t)&&c(n)?D(e,t,n,r):c(t)&&!c(n)?(e.appendChild(z(n)),e):!h(t)&&h(n)||h(t)&&!h(n)?G(e,t,n,r):t.type!==n.type?G(e,t,n,r):n.attributes&&n.attributes.forceUpdate?G(e,t,n,r):v(n)?t.tagName!==n.tagName?G(e,t,n,r):(R(e.childNodes[r],n.attributes,t.attributes),K(e,t,n,r)):b(n)?(t.nodeValue!==n.nodeValue&&(e.childNodes[r].nodeValue=n.nodeValue),e):y(n)?O(t,n)?Q(e,t,n,r):W(e,t,n,r):void 0}function D(e,t,n,r){J(t),e.removeChild(e.childNodes[r])}function G(e,t,n,r){var o=z(n);return J(t),e.replaceChild(o,e.childNodes[r]),o}function J(e){for(;y(e);){var t=e.options.onRemove,n=e.state.model;t&&t(n),e=e.state.vnode}e.children&&e.children.forEach(J)}function K(e,t,n,r){var o=t.children||[],i=n.children||[],u=void 0,a=Array.prototype.slice.call(e.childNodes),c=i.length;for(u=0;u<o.length||u<c;u++)B(a[r],o[u],i[u],u>=c?c:u);return e}function Q(e,t,n,r){var o=n.props,i={children:n.children,props:o},u=void 0;if(p(n.fn))u=t.state.$ins.render(i);else try{u=n.fn(i)}catch(e){u=t.state.$ins.render(i)}return o.onUpdate&&o.onUpdate(),B(e,t.state.vnode,u,r),n.state={vnode:u,$ins:t.state.$ins,model:i},e}function W(){return Q.apply(null,arguments)}function X(e,t){var n=this,r=t||{node:null,oldNode:null,ins:null},o=r.node,i=r.oldNode,u=r.ins;e="string"==typeof e?document.querySelector(e):e;var a=function(t){return"updateAll"===t&&function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;try{t=u&&u.render()}catch(e){}B(n,i,t),i=t}()};return t||(e.innerHTML=""),function(t){var r=t;if(r.children&&!r.children.length){var c=r,d=c.props,f=c.children,l=c.fn,s={children:f,props:d};(r=r.fn(s)).fn=l}return"render"in t&&(r=t.render(),u=t,t.$update=t.$update.bind(n,function(){a("updateAll")})),o?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return B(arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i,t),{node:o,oldNode:i=t,ins:u}}(r):function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return o=z(t,a),n.appendChild(o),{node:o,oldNode:i=t,ins:u}}(r)}}var Y=function(e){function i(){return t(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return r(i,C),n(i,[{key:"render",value:function(e){var t=e.props,n=e.children,r=A(n),o=E(n,"else");o.index>=0&&r.splice(o.index,1);var i=A(t);return delete i.cond,t.cond?N("div",i,r):N("div",i,o.children)}}]),i}(),Z=function(e){function i(){return t(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return r(i,C),n(i,[{key:"handlePath",value:function(e,t){var n=e.match(/__(.*?)__/g),r="";return n&&n.forEach(function(n){r=t[n.substring(2,n.length-2)],e=e.replace(n,void 0===r?"":r)}),e}},{key:"handleAttribute",value:function(e,t){var n=this;Object.keys(e).forEach(function(r){e[r]=n.handlePath(e[r],t)})}},{key:"handleChildren",value:function(e,t){var n=this;return e.forEach(function(e){e.nodeValue&&(e.nodeValue=n.handlePath(e.nodeValue,t)),e.attributes&&n.handleAttribute(e.attributes,t),e.children&&n.handleChildren(e.children,t)}),e}},{key:"render",value:function(e){var t=this,n=e.props,r=e.children;if(n.data){var o="",i=[];n.data.forEach(function(e,u){e.index=u,o=x(e,n.key||"item"),i=i.concat(t.handleChildren(A(r),o))});var u=A(n);return delete u.data,delete u.key,N("div",u,i)}return""}}]),i}(),ee=function(e){function i(){return t(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return r(i,C),n(i,[{key:"render",value:function(e){var t=e.props,n=e.children;if(t&&Object.keys(t).indexOf("cond")>=0){var r=E(n,"else"),o=n;r.index>=0&&(o=A(n)).splice(r.index,1);var i=A(t);return delete i.cond,t.cond?N("div",i,o):N("div",i,r.children)}return N("div",t,n)}}]),i}(),te=N,ne=C,re=Y,oe=Z,ie=ee,ue=function(e){for(var t=arguments,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=t[o];return function(){if("render"in r[0])X(e)(r[0]);else{var t=X(e)(N(r[0],null));r.map(function(n){n.$update=function(){t=X(e,t)(N(r[0],null))}})}}()};exports.l=te,exports.component=ne,exports.IF=re,exports.FOR=oe,exports.ELSE=ie,exports.app=ue;
